<nav class="bg-white border-b border-gray-200 shadow-sm dark:bg-[#121212] dark:border-black">
  <div class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <h1 class="text-2xl font-bold text-indigo-600 dark:text-white">How I Ate</h1>

      <!-- Dropdown Menu Button -->
      <div class="relative flex flex-row items-center gap-3">
        <button
          routerLink="/restaurants"
          class="inline-flex items-center justify-center gap-2 p-2 text-gray-700 rounded-md dark:text-white dark:hover:text-indigo-400 hover:text-indigo-600 hover:fill-indigo-500 dark:fill-white dark:hover:fill-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
          <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="20" height="20" class="text-gray-700 hover:text-indigo-600">
            <path d="M19,24H5c-2.757,0-5-2.243-5-5V9.724c0-1.665,.824-3.215,2.204-4.145L9.203,.855c1.699-1.146,3.895-1.146,5.594,0l7,4.724c1.379,.93,2.203,2.479,2.203,4.145v9.276c0,2.757-2.243,5-5,5ZM12,1.997c-.584,0-1.168,.172-1.678,.517L3.322,7.237c-.828,.558-1.322,1.487-1.322,2.486v9.276c0,1.654,1.346,3,3,3h14c1.654,0,3-1.346,3-3V9.724c0-.999-.494-1.929-1.321-2.486L13.678,2.514c-.51-.345-1.094-.517-1.678-.517Z"/>
          </svg>
          <span class="hidden font-medium lg:block">
            Home
          </span>
        </button>
        
        <!-- Mobile Search Icon -->
        <button
          (click)="toggleMobileSearch()"
          class="inline-flex items-center justify-center p-2 text-gray-700 rounded-md lg:hidden dark:text-white dark:hover:text-indigo-400 hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"
          aria-label="Cerca"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" class="fill-current">
            <path d="M23.707,22.293l-5.969-5.969a10.016,10.016,0,1,0-1.414,1.414l5.969,5.969a1,1,0,0,0,1.414-1.414ZM10,18a8,8,0,1,1,8-8A8.009,8.009,0,0,1,10,18Z"/>
          </svg>
        </button>
        
        <!-- Desktop Search Bar -->
        <div class="relative hidden lg:block">
          <div class="flex items-center bg-gray-100 dark:bg-[#49454F] rounded-lg px-3 py-2">
            <input
              type="text"
              [value]="searchQuery()"
              (input)="onSearchInputChange($event)"
              (focus)="showSearchDropdown.set(true)"
              placeholder="Cerca ristoranti..."
              class="bg-transparent outline-none text-sm text-gray-700 dark:text-white w-40 placeholder-gray-500"
            />
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" class="text-gray-500 dark:text-gray-400 fill-current">
              <path d="M11 19c-4.412 0-8-3.588-8-8s3.588-8 8-8 8 3.588 8 8-3.588 8-8 8zm0-14c-3.309 0-6 2.691-6 6s2.691 6 6 6 6-2.691 6-6-2.691-6-6-6zm7.712-1c-.423 0-.827.167-1.128.469l-3.712 3.712c-.601-.511-1.371-.81-2.212-.81-2.001 0-3.635 1.634-3.635 3.635 0 .841.298 1.611.81 2.212l-3.712 3.712c-.302.301-.469.705-.469 1.128 0 .423.167.827.469 1.128.301.302.705.469 1.128.469.423 0 .827-.167 1.128-.469l3.712-3.712c.601.511 1.371.81 2.212.81 2.001 0 3.635-1.634 3.635-3.635 0-.841-.298-1.611-.81-2.212l3.712-3.712c.302-.301.469-.705.469-1.128 0-.423-.167-.827-.469-1.128-.301-.302-.705-.469-1.128-.469z"/>
            </svg>
          </div>

          <!-- Search Results Dropdown -->
          <div
            *ngIf="showSearchDropdown()"
            (mouseleave)="closeSearch()"
            class="absolute top-full left-0 w-64 mt-2 bg-white dark:bg-[#49454F] rounded-lg shadow-lg z-20 max-h-96 overflow-y-auto"
          >
            <div *ngIf="isSearching()" class="p-4 text-center">
              <svg class="w-5 h-5 text-indigo-600 animate-spin mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>

            <div *ngIf="!isSearching() && searchResults().length === 0 && searchQuery()" class="p-4 text-center text-gray-500 dark:text-gray-400">
              Nessun ristorante trovato
            </div>

            <div *ngFor="let restaurant of searchResults()" class="border-b dark:border-gray-600 last:border-b-0">
              <button
                type="button"
                (click)="selectRestaurant(restaurant._id)"
                class="w-full text-left px-4 py-3 hover:bg-indigo-50 dark:hover:bg-[#3f3d44] transition duration-150"
              >
                <h4 class="font-semibold text-gray-900 dark:text-white">{{ restaurant.name }}</h4>
                <p class="text-sm text-gray-600 dark:text-gray-400" *ngIf="restaurant.cuisine">
                  {{ restaurant.cuisine }}
                </p>
                <p class="text-xs text-gray-500 dark:text-gray-500" *ngIf="restaurant.address">
                  {{ restaurant.address }}
                </p>
              </button>
            </div>
          </div>
        </div>
        <button
          (click)="goToMyRankings()"
          class="inline-flex items-center justify-center gap-2 p-2 text-gray-700 rounded-md dark:text-white dark:hover:text-indigo-400 hover:text-indigo-600 hover:fill-indigo-500 dark:fill-white dark:hover:fill-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
          <svg id="Layer_1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1" width="20" height="20" class="">
            <path d="m12 1c-7.71 0-11 3.29-11 11s3.29 11 11 11 11-3.29 11-11-3.29-11-11-11zm-4.293 19.475c.377-1.544 1.37-2.475 4.293-2.475s3.917.931 4.293 2.475c-1.176.357-2.594.525-4.293.525s-3.117-.168-4.293-.525zm10.413-.845c-1.012-3.217-3.916-3.631-6.119-3.631s-5.107.413-6.119 3.631c-2.028-1.35-2.881-3.774-2.881-7.631-.001-6.56 2.438-8.999 8.999-8.999s9 2.439 9 9c0 3.857-.853 6.281-2.881 7.631zm-6.12-13.63c-2.691 0-4 1.309-4 4s1.309 4 4 4 4-1.309 4-4-1.309-4-4-4zm0 6c-1.589 0-2-.411-2-2s.411-2 2-2 2 .411 2 2-.411 2-2 2z"/>
          </svg>
          <span class="hidden font-medium lg:block">
            Profilo
          </span>
        </button>
        <button
          (click)="toggleMenu()"
          class="inline-flex items-center justify-center p-2 text-gray-700 rounded-md dark:text-white dark:hover:text-indigo-400 hover:text-indigo-600 hover:fill-indigo-500 dark:fill-white dark:hover:fill-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
          <svg
            class="w-6 h-6"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>

        <!-- Dropdown Menu -->
        <div
          *ngIf="menuOpen"
          class="absolute right-0 z-20 w-48 py-2 mt-2 bg-white dark:bg-[#49454F] rounded-md shadow-lg top-8 ring-1 ring-black ring-opacity-5"
        >
          <a
            routerLink="/settings"
            class="flex flex-row items-center gap-4 px-4 py-2 text-sm text-gray-700 dark:text-white dark:fill-white hover:bg-indigo-100 hover:text-indigo-600"
          >
            <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="16" height="16" class="inline w-4 h-4 mr-2 fill-current">
              <path d="M12.208,8.328c-.916-.077-1.788,.326-2.67,1.209-1.634,1.635-1.634,3.292,0,4.925,.481,.482,1.239,1.142,2.254,1.21,.966,.064,1.854-.392,2.67-1.21,1.634-1.634,1.633-3.292,0-4.925-.481-.482-1.239-1.132-2.254-1.21Zm.84,4.721s0,0,0,0c-.302,.302-.767,.655-1.102,.629-.262-.02-.596-.232-.993-.629-.787-.787-.897-1.2,0-2.098,.291-.291,.706-.63,1.061-.63,.014,0,.028,0,.041,.001,.262,.02,.596,.232,.993,.629,.787,.787,.897,1.2,0,2.098Z"/>
              <path d="M22.994,11.954c.006-1.206-.452-2.662-2.571-3.05-.11-.21-.231-.421-.364-.633,1.068-1.479,.986-2.851-.248-4.085-1.235-1.236-2.607-1.317-4.087-.245-.209-.132-.418-.252-.627-.36-.382-2.112-1.824-2.58-3.027-2.58-1.69,0-2.771,.891-3.086,2.624-.208,.109-.418,.23-.629,.362-1.473-1.064-2.846-.973-4.093,.272-1.243,1.244-1.333,2.618-.272,4.091-.133,.212-.255,.423-.366,.633-1.729,.316-2.609,1.345-2.618,3.063-.006,1.206,.452,2.662,2.571,3.05,.11,.21,.231,.421,.365,.633-1.069,1.479-.987,2.851,.247,4.085,1.235,1.236,2.608,1.317,4.087,.245,.209,.132,.418,.252,.627,.36,.382,2.112,1.824,2.58,3.027,2.58,1.721,0,2.771-.891,3.086-2.624,.208-.109,.418-.23,.629-.362,1.471,1.061,2.84,.968,4.092-.272s1.334-2.618,.273-4.092c.133-.212,.255-.423,.366-.632,1.729-.316,2.609-1.345,2.618-3.063Zm-3.369,1.147c-.364,.031-.682,.259-.829,.593-.201,.456-.483,.934-.839,1.419-.282,.385-.252,.917,.071,1.269,1.073,1.166,.713,1.527,.295,1.945-.435,.436-.78,.78-1.943-.296-.352-.324-.883-.354-1.27-.072-.483,.354-.959,.635-1.416,.834-.335,.147-.563,.465-.595,.831-.118,1.37-.6,1.373-1.157,1.375-.565,0-1.018,.006-1.122-1.326-.029-.371-.261-.695-.603-.841-.454-.195-.927-.472-1.405-.825-.177-.131-.386-.195-.594-.195-.244,0-.487,.089-.678,.265-1.179,1.087-1.532,.732-1.939,.324-.409-.409-.762-.763,.322-1.94,.325-.353,.354-.886,.068-1.272-.356-.481-.635-.955-.83-1.407-.146-.341-.47-.573-.839-.602-1.325-.106-1.323-.555-1.32-1.123,.003-.581,.005-1.04,1.369-1.158,.364-.031,.682-.259,.829-.593,.202-.457,.484-.935,.839-1.42,.282-.385,.252-.917-.071-1.269-1.073-1.165-.712-1.526-.295-1.944,.435-.435,.78-.779,1.943,.295,.352,.325,.883,.354,1.269,.072,.484-.354,.96-.634,1.417-.834,.335-.147,.563-.465,.595-.831,.118-1.37,.6-1.373,1.157-1.375,.573,.004,1.018-.006,1.122,1.326,.029,.371,.261,.695,.603,.841,.454,.195,.927,.472,1.405,.825,.385,.284,.919,.255,1.271-.069,1.179-1.087,1.531-.732,1.939-.324,.409,.409,.763,.763-.322,1.94-.325,.353-.354,.887-.069,1.272,.356,.481,.635,.955,.83,1.407,.146,.341,.47,.573,.839,.602,1.325,.106,1.323,.555,1.32,1.123-.003,.581-.005,1.04-1.369,1.158Z"/>
            </svg>
            Impostazioni
          </a>
          <button
            (click)="logout()"
            class="flex flex-row items-center w-full gap-4 px-4 py-2 text-sm text-left text-gray-700 dark:text-white dark:fill-white hover:bg-indigo-100 hover:text-indigo-600"
          >
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve" width="16" height="16" class="inline w-4 h-4 mr-2 fill-current">
              <g>
                <path d="M487.06,195.669l-82.752-82.752c-8.475-8.185-21.98-7.95-30.165,0.525c-7.985,8.267-7.985,21.374,0,29.641l82.752,82.752   c2.459,2.507,4.607,5.301,6.4,8.32c-0.32,0-0.576-0.171-0.896-0.171l0,0l-334.592,0.683c-11.782,0-21.333,9.551-21.333,21.333   c0,11.782,9.551,21.333,21.333,21.333l0,0l334.464-0.683c0.597,0,1.088-0.299,1.664-0.341c-1.892,3.609-4.292,6.928-7.125,9.856   l-82.752,82.752c-8.475,8.185-8.71,21.69-0.525,30.165c8.185,8.475,21.69,8.71,30.165,0.525c0.178-0.172,0.353-0.347,0.525-0.525   l82.752-82.752c33.313-33.323,33.313-87.339,0-120.661L487.06,195.669z"/>
                <path d="M149.374,469.333h-42.667c-35.346,0-64-28.654-64-64V106.667c0-35.346,28.654-64,64-64h42.667   c11.782,0,21.333-9.551,21.333-21.333S161.157,0,149.374,0h-42.667C47.827,0.071,0.112,47.786,0.041,106.667v298.667   C0.112,464.214,47.827,511.93,106.708,512h42.667c11.782,0,21.333-9.551,21.333-21.333   C170.708,478.885,161.157,469.333,149.374,469.333z"/>
              </g>
            </svg>
            Esci
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Search Bar (shown when search icon is clicked) -->
    <div *ngIf="showMobileSearch()" class="pb-4 lg:hidden">
      <div class="relative">
        <div class="flex items-center bg-gray-100 dark:bg-[#49454F] rounded-lg px-3 py-2">
          <input
            type="text"
            [value]="searchQuery()"
            (input)="onSearchInputChange($event)"
            (focus)="showSearchDropdown.set(true)"
            placeholder="Cerca ristoranti..."
            class="flex-1 bg-transparent outline-none text-sm text-gray-700 dark:text-white placeholder-gray-500"
            autofocus
          />
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" class="text-gray-500 dark:text-gray-400 fill-current ml-2">
            <path d="M23.707,22.293l-5.969-5.969a10.016,10.016,0,1,0-1.414,1.414l5.969,5.969a1,1,0,0,0,1.414-1.414ZM10,18a8,8,0,1,1,8-8A8.009,8.009,0,0,1,10,18Z"/>
          </svg>
        </div>

        <!-- Mobile Search Results Dropdown -->
        <div
          *ngIf="showSearchDropdown()"
          class="absolute top-full left-0 right-0 mt-2 bg-white dark:bg-[#49454F] rounded-lg shadow-lg z-20 max-h-96 overflow-y-auto"
        >
          <div *ngIf="isSearching()" class="p-4 text-center">
            <svg class="w-5 h-5 text-indigo-600 animate-spin mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>

          <div *ngIf="!isSearching() && searchResults().length === 0 && searchQuery()" class="p-4 text-center text-gray-500 dark:text-gray-400">
            Nessun ristorante trovato
          </div>

          <div *ngFor="let restaurant of searchResults()" class="border-b dark:border-gray-600 last:border-b-0">
            <button
              type="button"
              (click)="selectRestaurant(restaurant._id)"
              class="w-full text-left px-4 py-3 hover:bg-indigo-50 dark:hover:bg-[#3f3d44] transition duration-150"
            >
              <h4 class="font-semibold text-gray-900 dark:text-white">{{ restaurant.name }}</h4>
              <p class="text-sm text-gray-600 dark:text-gray-400" *ngIf="restaurant.cuisine">
                {{ restaurant.cuisine }}
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-500" *ngIf="restaurant.address">
                {{ restaurant.address }}
              </p>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>